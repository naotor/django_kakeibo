<!-- 親テンプレートを読み込む-->
{% extends 'kakeibo/layout.html' %}
{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>

<div class="content-wrapper">
    <div class="container-fluid">
        <!-- パンくずリストの設定-->
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{% url 'kakeibo:kakeibo_list' %}">TOP</a>
            </li>
            <li class="breadcrumb-item active">カテゴリ毎の合計金額推移</li>
        </ol>
        <!--ページタイトル-->
        <div class="card mb-3">
            <div class="card-header">
                <h3><b>家計簿アプリ（カテゴリ毎の合計金額推移）</b></h3>
            </div>
        <div class="card-body">
            <!-- 円グラフの描画-->
            <div class="chart_container">
                <canvas id='LineChart' style="position: relative; height:25vh; width:25vw"></canvas>
            </div>
            <!-- テーブル表の定義 -->
            <table id=kakeibo_list width="100%" class="table table-striped table-bordered table-hover">
              　<!-- 表の列の定義-->
                <thead>
                    <tr style="background-color:rgb(224, 228, 226)">
                        <th class="text-center width="10">日付</th>
                        <th class="text-center">カテゴリ</th>
                        <th class="text-center">合計金額</th>
                    </tr>
                </thead>
              　<!-- ここまでが表の列の定義-->
                <hr>
              　<!-- 表のデータ部分の表示-->
                <tbody>
                {% for date, category, total in matrix_list %}
                    <tr class="odd gradeX text-center">
                        <td class="text-center">{{ date }}</td>
                        <td class="text-center">{{ category }}</td>
                        <td class="text-center">{{ total }}</td>
                    </tr>
                {% endfor %}
                </tbody>
              　<!-- ここまでが表のデータ部分の表示-->
            </table>
            <!-- ここまでがテーブル表の定義 -->
        </div>
    </div>
</div>

<!-- キャンバスの定義-->
<style>
    @media screen and (min-width: 768px) {
        .chart_container {
            width: 640px;
            margin: auto;
        }
    }
</style>

<!-- 折れ線グラフの設定-->
<script>
    var ctx = document.getElementById("LineChart").getContext('2d');
    var DiskChart = new Chart(ctx, {
    type: 'line',
      data: {
        labels:[
          {% for item in x_label %}
               '{{item}}',
          {% endfor %}],

        datasets: [
        {% for category_name in category_list %}
         {
          label: "{{category_name}}",
          fill: false,
          {% for category, color in border_color %}
                 {% if category == category_name %}
                    borderColor : "rgba({{color}})",
                 {% endif %}
             {% endfor %}

             {% for category, color in background_color %}
                 {% if category == category_name %}
                    backgroundColor : "rgba({{color}})",
                 {% endif %}
             {% endfor %}

          data: [
          {% for time_label in x_label %}

             {% for date, category, total in matrix_list %}
                {% if category == category_name %}
                   {% if date == time_label %}
                     {{total}},
                   {% endif %}
                {% endif %}
             {% endfor %}
          {% endfor %}
          ],
         },
       {% endfor %}
      ]
    },

         options: {
          responsive: true,
          scales: {
            xAxes: [{
              scaleLabel: {
                display: true,
                labelString: '時間'
              },
              ticks: {           // 目盛り
                  maxRotation:0, //X軸の表示角度調整
                  minRotation:0  //X軸の表示角度調整
                },
              }],
              yAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: '合計金額（円）'
                },
              ticks:{
                min: 0,   // 最小値
                }
               }],
             },
            title: {
              display: true,         // 表示設定
              pocision: "top",       // 表示位置
              fontSize: 30,          // フォントサイズ
              fontColor: "black",    // 文字の色
              text: "月毎の合計金額推移" // タイトル文字列
            },
       }
  });
  </script>
{% endblock content %}